# ============================================================================
# MailAgent Environment Configuration
# ============================================================================
#
# This is a comprehensive environment configuration file for MailAgent.
# Copy this file to .env and fill in your actual values.
#
# REQUIRED variables must be set before starting the application.
# OPTIONAL variables have sensible defaults but can be customized.
#
# For local development with Docker:
#   cp .env.docker .env
#
# For production deployment:
#   cp .env.example .env
#   # Then customize all values, especially secrets!
#
# Generate secure secrets with:
#   openssl rand -hex 32  # For ENCRYPTION_KEY, JWT_SECRET, etc.
#   openssl rand -hex 16  # For ENCRYPTION_IV
#
# ============================================================================

# ----------------------------------------------------------------------------
# Application
# ----------------------------------------------------------------------------

# Environment: development | production | staging | test
# REQUIRED
NODE_ENV=development

# API server port (1024-65535)
# REQUIRED
API_PORT=3001

# API host (for building URLs)
# OPTIONAL - Default: localhost
API_HOST=localhost

# API public URL (if behind reverse proxy)
# OPTIONAL - Default: http://<API_HOST>:<API_PORT>
# API_PUBLIC_URL=https://api.yourdomain.com

# Frontend URL (for CORS and redirects)
# OPTIONAL - Default: http://localhost:3000
FRONTEND_URL=http://localhost:3000

# Log level: error | warn | log | debug | verbose
# OPTIONAL - Default: log
# LOG_LEVEL=log

# Log all HTTP requests (true/false)
# OPTIONAL - Default: false
# LOG_REQUESTS=true

# ----------------------------------------------------------------------------
# Database (PostgreSQL with pgvector)
# ----------------------------------------------------------------------------

# Database connection URL (REQUIRED)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://mailuser:mailpass@localhost:5432/mailagent

# OR use individual components (for building DATABASE_URL)
# OPTIONAL - Only if not using DATABASE_URL directly
# DB_HOST=localhost
# DB_PORT=5432
# DB_USER=mailuser
# DB_PASSWORD=mailpass
# DB_NAME=mailagent

# ----------------------------------------------------------------------------
# Redis (Cache & Queues)
# ----------------------------------------------------------------------------

# Redis host
# OPTIONAL - Default: localhost
REDIS_HOST=localhost

# Redis port
# OPTIONAL - Default: 6379
REDIS_PORT=6379

# Redis password (STRONGLY RECOMMENDED in production)
# OPTIONAL - Default: none
REDIS_PASSWORD=mailredispass

# Redis database number
# OPTIONAL - Default: 0
# REDIS_DB=0

# ----------------------------------------------------------------------------
# Authentication & Security
# ----------------------------------------------------------------------------

# JWT secret key (REQUIRED) - MUST be strong and unique!
# Generate with: openssl rand -hex 32
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# JWT token expiration (OPTIONAL) - Default: 24h
# Examples: 1h, 7d, 30d
JWT_EXPIRATION=24h

# OTP expiration in minutes (OPTIONAL) - Default: 10
# OTP_EXPIRATION_MINUTES=10

# Password reset expiration in minutes (OPTIONAL) - Default: 60
# PASSWORD_RESET_EXPIRATION_MINUTES=60

# Encryption key for sensitive data (REQUIRED) - MUST be 32 hex chars (16 bytes)
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=your-32-character-hex-encryption-key-here

# Encryption IV (REQUIRED) - MUST be 16 hex chars (8 bytes)
# Generate with: openssl rand -hex 16
ENCRYPTION_IV=your-16-character-hex-iv-here

# ----------------------------------------------------------------------------
# OAuth Providers
# ----------------------------------------------------------------------------

# Google OAuth (REQUIRED)
# Get credentials from: https://console.cloud.google.com
# 1. Create project
# 2. Enable Gmail API
# 3. Configure OAuth consent screen
# 4. Create OAuth 2.0 Client ID
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:3001/auth/google/callback

# Microsoft OAuth (REQUIRED)
# Get credentials from: https://portal.azure.com
# 1. Register an application
# 2. Add API permissions (Mail.Read, Mail.Send, etc.)
# 3. Create client secret
MICROSOFT_CLIENT_ID=your-microsoft-client-id
MICROSOFT_CLIENT_SECRET=your-microsoft-client-secret
MICROSOFT_REDIRECT_URI=http://localhost:3001/auth/microsoft/callback

# ----------------------------------------------------------------------------
# AI Services
# ----------------------------------------------------------------------------

# Mistral AI API Key (REQUIRED)
# Get from: https://console.mistral.ai
MISTRAL_API_KEY=your-mistral-api-key

# Mistral AI API URL (OPTIONAL)
# Default: https://api.mistral.ai/v1
# MISTRAL_API_URL=https://api.mistral.ai/v1

# Mistral model (OPTIONAL)
# Default: mistral-small-latest
# MISTRAL_MODEL=mistral-small-latest

# ----------------------------------------------------------------------------
# Email (SMTP)
# ----------------------------------------------------------------------------

# SMTP server for sending emails (verification, notifications, etc.)
# OPTIONAL - Default: localhost:1025 (MailHog for dev)

# For production, use a real SMTP service like:
# - SendGrid: smtp.sendgrid.net:587
# - AWS SES: email-smtp.us-east-1.amazonaws.com:587
# - Gmail: smtp.gmail.com:587 (requires app password)

SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=
SMTP_FROM=noreply@mailagent.local

# SMTP secure connection (true/false)
# OPTIONAL - Default: false
# SMTP_SECURE=false

# ----------------------------------------------------------------------------
# Webhooks (Real-time notifications)
# ----------------------------------------------------------------------------

# Generic webhook secret for custom integrations
# OPTIONAL - Generate with: openssl rand -hex 32
WEBHOOK_SECRET=your-webhook-secret-change-this

# Google webhook token (for Gmail push notifications)
# OPTIONAL - Used to validate Google's webhook calls
GOOGLE_WEBHOOK_TOKEN=your-google-webhook-token

# Microsoft webhook secret (for Outlook push notifications)
# OPTIONAL - Used to validate Microsoft's webhook calls
MICROSOFT_WEBHOOK_SECRET=your-microsoft-webhook-secret

# ----------------------------------------------------------------------------
# CORS (Cross-Origin Resource Sharing)
# ----------------------------------------------------------------------------

# Allow all origins (true/false) - USE WITH CAUTION!
# OPTIONAL - Default: false (recommended for security)
# CORS_ALLOW_ALL=false

# Allowed origins (comma-separated list)
# OPTIONAL - Default: FRONTEND_URL
# Example: https://app.yourdomain.com,https://admin.yourdomain.com
# CORS_ALLOWED_ORIGINS=http://localhost:3000

# Allowed origin regex patterns (comma-separated)
# OPTIONAL - Useful for ngrok, Vercel preview deployments
# Example: https://.*\.ngrok\.io,https://.*-yourusername\.vercel\.app
# CORS_ALLOWED_REGEX=

# ----------------------------------------------------------------------------
# Rate Limiting
# ----------------------------------------------------------------------------

# Rate limit window in milliseconds (OPTIONAL)
# Default: 60000 (1 minute)
# RATE_LIMIT_TTL_MS=60000

# Maximum requests per window (OPTIONAL)
# Default: 100
# RATE_LIMIT_MAX=100

# ----------------------------------------------------------------------------
# Proxy Configuration
# ----------------------------------------------------------------------------

# Trust proxy headers (for deployments behind nginx/traefik/cloudflare)
# OPTIONAL - Default: loopback,linklocal,uniquelocal
# Values: true | false | <comma-separated IP ranges>
# TRUST_PROXY=loopback,linklocal,uniquelocal

# ----------------------------------------------------------------------------
# Features & Toggles
# ----------------------------------------------------------------------------

# Enable Swagger API documentation (true/false)
# OPTIONAL - Default: true in development, false in production
ENABLE_SWAGGER=true

# Enable metrics collection (true/false)
# OPTIONAL - Default: true
ENABLE_METRICS=true

# Enable request logging (true/false)
# OPTIONAL - Default: false (can be noisy in production)
LOG_REQUESTS=true

# Suppress individual message events in realtime (batch instead)
# OPTIONAL - Default: false
# REALTIME_SUPPRESS_MESSAGE_EVENTS=false

# ----------------------------------------------------------------------------
# Email Sync Configuration
# ----------------------------------------------------------------------------

# Gmail API settings (OPTIONAL)
# GMAIL_BATCH_GET_SIZE=100
# GMAIL_HISTORY_MAX_PAGES=25
# GMAIL_FULL_MAX_MESSAGES=200
# GMAIL_RETRY_MAX_ATTEMPTS=3
# GMAIL_RETRY_429_DELAY_MS=2000
# GMAIL_RETRY_5XX_DELAY_MS=2000

# Microsoft Graph API settings (OPTIONAL)
# MICROSOFT_BATCH_SIZE=100
# MICROSOFT_MAX_RETRIES=3

# IMAP settings (for generic IMAP providers)
# OPTIONAL - Used as defaults if provider config is missing
# IMAP_HOST=imap.example.com
# IMAP_PORT=993
# IMAP_SECURE=true
# IMAP_USER=
# IMAP_PASSWORD=

# ----------------------------------------------------------------------------
# Realtime (WebSocket) Configuration
# ----------------------------------------------------------------------------

# Email event buffer time in milliseconds
# OPTIONAL - Default: 200ms
# REALTIME_EMAIL_BUFFER_MS=200

# Maximum buffered email events before flush
# OPTIONAL - Default: 500
# REALTIME_EMAIL_BUFFER_MAX=500

# Folder count buffer time in milliseconds
# OPTIONAL - Default: 250ms
# REALTIME_FOLDER_BUFFER_MS=250

# Maximum buffered folder count updates before flush
# OPTIONAL - Default: 200
# REALTIME_FOLDER_BUFFER_MAX=200

# ----------------------------------------------------------------------------
# Storage (MinIO / S3) - OPTIONAL
# ----------------------------------------------------------------------------

# S3-compatible storage for email attachments
# Only required if using attachment storage
# Use MinIO for local development, S3/R2 for production

# S3_ENDPOINT=http://localhost:9000
# S3_ACCESS_KEY=minioadmin
# S3_SECRET_KEY=minioadmin123
# S3_BUCKET=mailagent-attachments
# S3_REGION=us-east-1
# S3_USE_SSL=false

# ----------------------------------------------------------------------------
# Speech-to-Text (STT) - OPTIONAL
# ----------------------------------------------------------------------------

# STT provider: google | whisper | none
# STT_PROVIDER=none

# Google Cloud STT API key (if using Google)
# GOOGLE_STT_API_KEY=

# ----------------------------------------------------------------------------
# Text-to-Speech (TTS) - OPTIONAL
# ----------------------------------------------------------------------------

# TTS provider: piper | google | none
# TTS_PROVIDER=none

# Piper voice language (if using Piper)
# PIPER_LANGUAGE=en_US

# ----------------------------------------------------------------------------
# Development & Testing
# ----------------------------------------------------------------------------

# Disable authentication (DANGEROUS - development only!)
# OPTIONAL - Default: false
# DISABLE_AUTH=false

# Mock external services (for testing without real APIs)
# OPTIONAL - Default: false
# MOCK_EXTERNAL_SERVICES=false

# Seed database with test data on startup
# OPTIONAL - Default: false
# SEED_DATABASE=false

# Enable debug logging for specific modules
# OPTIONAL - Comma-separated list: email,sync,auth,ai,webhooks
# DEBUG_MODULES=

# ============================================================================
# Quick Start Commands
# ============================================================================
#
# 1. Install dependencies:
#    npm install
#
# 2. Start PostgreSQL and Redis with Docker:
#    docker-compose up -d
#
# 3. Run database migrations:
#    npx prisma migrate dev
#
# 4. Generate Prisma client:
#    npx prisma generate
#
# 5. Start the backend:
#    npm run start:dev
#
# 6. Access the API:
#    http://localhost:3001
#
# 7. Access Swagger docs:
#    http://localhost:3001/api/docs
#
# 8. Access MailHog (email testing):
#    http://localhost:8025
#
# 9. Access Redis Commander (optional):
#    docker-compose --profile tools up -d
#    http://localhost:8081
#
# ============================================================================
# Production Deployment Checklist
# ============================================================================
#
# [ ] Set NODE_ENV=production
# [ ] Generate strong secrets for JWT_SECRET, ENCRYPTION_KEY, ENCRYPTION_IV
# [ ] Use real SMTP service (SendGrid, AWS SES, etc.)
# [ ] Configure proper DATABASE_URL (managed PostgreSQL)
# [ ] Configure proper REDIS_HOST and REDIS_PASSWORD (managed Redis)
# [ ] Set up OAuth apps with production redirect URIs
# [ ] Enable HTTPS and set proper API_PUBLIC_URL
# [ ] Configure CORS_ALLOWED_ORIGINS (whitelist only)
# [ ] Set TRUST_PROXY correctly for your infrastructure
# [ ] Disable ENABLE_SWAGGER=false in production
# [ ] Set up monitoring and error tracking
# [ ] Configure backup strategy for PostgreSQL
# [ ] Set up SSL/TLS for Redis connection
# [ ] Review and adjust rate limiting settings
# [ ] Set up webhook endpoints with proper secrets
# [ ] Test failover and disaster recovery procedures
#
# ============================================================================
